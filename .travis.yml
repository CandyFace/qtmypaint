# Travis-CI configuration file for SuperTuxKart modified by CandyFace for Pencil2D
#
# Configuration manual:
# http://docs.travis-ci.com/user/build-configuration/
#
# How to use TravisCI with C++ (Qt Test, C++11):
# https://github.com/richelbilderbeek/travis_qmake_gcc_cpp11_qt_qtests
#
language: cpp
compiler: g++
sudo: required
dist: trusty
osx_sdk: macosx10.12
os:
  - linux
  - osx

python:
  - "3.4"

addons:
  apt:
    sources:
      - ubuntu-toolchain-r-test
      - ubuntu-sdk-team
      - trusty-media
      - sourceline: 'ppa:beineri/opt-qt591-trusty'
    packages:
      - build-essential
      - qt59tools
      - qt59base
      - python3
      - python3-pip

before_install:
  - |
    if [ "$TRAVIS_OS_NAME" == "osx" ]; then
        brew update;
        ver=$(python -V 2>&1 | sed "s/.* \([0-9]\).\([0-9]\).*/\1\2/");
        python -V
        if [ "$ver" -le "27" ]; then
            brew upgrade python;
        fi
        brew install p7zip;
        brew install qt;
        brew link qt --force;
    fi
  - |
    if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then 
      sudo apt-get install -y p7zip-full; 
    fi

install:
  - pip3 freeze > requirements.txt
  - pip3 install -r requirements.txt
  - sudo pip3 install --upgrade oauth2client
  - sudo pip3 install --upgrade google-api-python-client
  - python3 -V
  - pip3 -V

before_script:


script:
  - mkdir "build" && cd build
  - qmake ../ CONFIG+=release
  - make

env:
  global:
    secure: LnLne9hTgdkgScA7gLnmS+ApP2WZ7D7Qa2ElRU2aP6cQsajNuPlDd40zicq3ef6yLdZWzzPGPFL1yZSWLfSEA8UTsUSZMprMYlOUIite0d7OPxoURyFREoZyCUsb+MULnKhpVEElyKpftR6qXLikofw6mnw5rkcPZAVSpOqKt8uKWQMUBT0Djba9jNKKtlmARc5MibvXbxyvZPFSgGftvbDJEDl+vqbjuGiiwGkQQP2OIJBjvo+lSu/dRg9WTEvqjH8ek/JIE9GiBUxlFdMVqf2hW+gFOXr/jAJn9wXiz8ib9aRbbYbMgalEjp3cyzuGQWHSNLLSN/SSnqVeCmrv0YZS4S+34C7dnjnFuMATEfJFaV8iIriS28gKawMSg7iHQImnCyxEFSj+LUcj7nqSZmGVg6euH2jr3HLzWZFGOdojEsJuvPyXF+6BPAKHLomCtVcX8wy3vIayaTxgPpSN2qWCWmMdq+jCs5xdspC4bR/VuHq8UIRwF7M2+x/M0rHdRTxrzWXLpFImOd7CP+6eGyA2w/hP08t2LBp7AeTIIAlCaKweixEahnKHYbIkivN8aTTqAZf3shPWFLxzkvllE1ua6MlkGQCphZVA4S0x3+G5Kw+c7Nh9YUGUrzCcETiPfZWyiQfTvggiKQ5+nw2dNvif/4vpmivw6+YF4RKEAtY=

after_success:
  - cd ${TRAVIS_BUILD_DIR}/build
  - ls src/*.a
  - 7z a -r qtmypaint-${TRAVIS_OS_NAME}.zip src/*.a $ src/*.lib

before_deploy:
  - export RELEASE_PKG_FILE=$(ls ${TRAVIS_BUILD_DIR}/build/*.zip)
  - echo "deploying $RELEASE_PKG_FILE to GitHub releases"

  # Set up git user name and tag this commit
  - git config --local user.name "TRAVIS CI"
  - git config --local user.email "travis-ci@travis.org"
  - export TRAVIS_TAG="qtmypaint-${TRAVIS_BRANCH}"
  - git tag $TRAVIS_TAG
deploy:
  provider: releases
  api_key: "$DEPLOYER_TOKEN"
  file_glob: true
  file: ${RELEASE_PKG_FILE}
  skip_cleanup: true
  overwrite: true
  draft: true
  on:
    all_branches: true
